#!/bin/bash

set -e
#set -x

function mountDevice {
	mkdir -p /mnt/$1
	if [[ $(mount | grep /dev/$1 | grep /mnt/$1) ]]; then
		echo "$1 already mounted"
	else
		mount /dev/$1 /mnt/$1
		echo "$1 was mounted"
	fi;
}

function umountDevice {
	if [[ $(mount | grep /dev/$1 | grep /mnt/$1) ]]; then
		umount /mnt/$1
		echo "$1 was umounted"
	else
		echo "$1 is not mounted"
	fi;
}

function syncFromTo {
	umountDevice $1
	umountDevice $2
	mountDevice $1
	mountDevice $2
	echo "start sync $1 to $2"
	rsync -axHAWXS --numeric-ids --info=progress2 --delete /mnt/$1 /mnt/$2
	echo "done sync $1 to $2"
	umountDevice $1
	umountDevice $2
}

syncFromTo sda1 sdb1
syncFromTo sda5 sdb5